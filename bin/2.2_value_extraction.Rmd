---
title: "Climate data processing"
output: rmarkdown::github_document
---

Para el procesamiento y extracción de los valores a partir de las capas ASCII.

Empezamos con limpiar el área de trabajo y cargar los paquetes de R

```{r}
    # Elimina TODOS los objetos del ambiente de trabajo
    rm(list=ls()) 

    #Librerias
    library(sp)
    library(raster)
    #library(rgeos)
    #library(maptools)
    #library(rgdal)
    library(usdm)
    library(foreign)
    #library(rJava)
    #library(spocc)
    library(corrplot)
```

Las capas con las cuáles se trabajará son de formato ASCII y son capas con valores actuales descargadas desde el portal de WorldClim

```{r}
#Cargar capas
pca_path <- list.files("../data/climate/wc/actual/",pattern = "*.asc$",full.names = T)
pca_path

# Crear el conjunto de las 19 variables climaticas del presente
capas_presente<- stack(pca_path)

# Cargar la base de datos con los puntos de presencia
datos <- read.csv("../metadata/Datos-wordlclime.csv")

# Imprimir 
datos
```

Revisamos las coordenadas de los individuos

```{r}
#Crear un data.frame con las coordenadas por individuos
especie<-datos$specie
lat<-datos$x
lon<-datos$y
especie_estudio<-data.frame(especie,lon,lat)
# Imprimir 
especie_estudio

```

La extracción de los valores de las capas de WorldClim a partir de los datos de coordenadas de los individuos muestreados generará un archivo CSV que despúes se exportará

```{r}
# Extrae los valores climaticos para cada uno de los puntos de presencia
presencias_clima <- data.frame(extract(capas_presente,especie_estudio[,2:3]))
presencias_clima2<-data.frame(especie_estudio,presencias_clima)
# omite mis datos de presencia sin valores climaticos
presencias_clima3 <- na.omit(presencias_clima2)

#Imprimir data.frame
presencias_clima3

#Exportar los resultados en un archivo .csv para guardar el archivo de puntos
write.csv(presencias_clima3, file = "../metadata/datos_extraccion_worldClim.csv")
```
